---
#
- name: create sonarqube home
  file:
    path: "{{ sonarqube_home }}"
    state: directory

- name: install sonarqube
  unarchive:
    src: "{{ sonarqube_url }}"
    dest: "{{ sonarqube_home }}"
    copy: no
    creates: "{{ sonarqube_home }}/sonar/COPYING"

- name: configure sonarqube database connection
  lineinfile:
    dest: "{{ sonarqube_home }}/conf/sonar.properties"
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
  notify: restart sonar
  with_items:
    -
      regexp: "^sonar.jdbc.url"
      line: "sonar.jdbc.url={{ sonarqube_jdbc_url }}"
